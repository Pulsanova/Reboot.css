name : Publication
on:
    push:
        tags: ['*']
jobs:
    publish:
        runs-on : ubuntu-latest
        steps   :
            - uses: actions/checkout@v2
            - uses: actions/setup-node@v1
              with:
                registry-url : https://npm.pkg.github.com/
                scope        : '@pulsanova'
            - run: |
                echo "@pulsanova:registry=https://npm.pkg.github.com/" > .npmrc
                echo "//npm.pkg.github.com/:_authToken=$NODE_AUTH_TOKEN" >> .npmrc
              env:
                NODE_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            - run: yarn install
            - run: yarn build
            - run: yarn publish
    publish-doc:
        needs   : publish
        runs-on : ubuntu-latest
        steps   :
            - uses: actions/checkout@v2
              with:
                persist-credentials: false
            - uses: actions/setup-node@v1
              with:
                registry-url : https://npm.pkg.github.com/
                scope        : '@pulsanova'
            - run: |
                echo "@pulsanova:registry=https://npm.pkg.github.com/" > .npmrc
                echo "//npm.pkg.github.com/:_authToken=$NODE_AUTH_TOKEN" >> .npmrc
              env:
                NODE_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            - run: yarn install
            - run: yarn build:doc
            - uses : JamesIves/github-pages-deploy-action@3.7.1
              with :
                GITHUB_TOKEN : ${{ secrets.GITHUB_TOKEN }}
                BRANCH       : gh-pages
                FOLDER       : sassdoc
                CLEAN        : true
